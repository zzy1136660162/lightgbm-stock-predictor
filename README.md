# LightGBM è‚¡ç¥¨1ä¸ªæœˆé¢„æµ‹åŸºçº¿æ¨¡å‹

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨LightGBMé¢„æµ‹è‚¡ç¥¨æœªæ¥ä¸€ä¸ªæœˆæ”¶ç›Šçš„å®Œæ•´é‡åŒ–é¡¹ç›®ã€‚é¡¹ç›®åŒ…å«æ•°æ®è·å–ã€ç‰¹å¾å·¥ç¨‹ã€æ¨¡å‹è®­ç»ƒã€ä¿¡å·ç”Ÿæˆã€å›æµ‹å’Œè¯„ä¼°çš„å…¨æµç¨‹ã€‚

## ğŸ¯ é¡¹ç›®ç‰¹ç‚¹

- **æ•°æ®è·å–**: ä½¿ç”¨akshareè·å–è‚¡ç¥¨æ•°æ®ï¼ˆæ”¯æŒä¸Šè¯æŒ‡æ•°å’Œä¸ªè‚¡ï¼‰
- **ç‰¹å¾å·¥ç¨‹**: åŒ…å«æŠ€æœ¯æŒ‡æ ‡ã€ä»·æ ¼ç‰¹å¾ã€æˆäº¤é‡ç‰¹å¾ç­‰50+ç‰¹å¾
- **æ¨¡å‹è®­ç»ƒ**: LightGBMå›å½’æ¨¡å‹ï¼Œæ”¯æŒæ ‡å‡†è®­ç»ƒå’ŒWalk-forwardè®­ç»ƒ
- **ä¿¡å·ç”Ÿæˆ**: åŸºäºé¢„æµ‹ç»“æœç”Ÿæˆäº¤æ˜“ä¿¡å·å’Œå¤´å¯¸ç®¡ç†ç­–ç•¥
- **å›æµ‹ç³»ç»Ÿ**: å®Œæ•´çš„å›æµ‹æµç¨‹ï¼Œæ”¯æŒäº¤æ˜“è´¹ç”¨å’Œæ»‘ç‚¹æ¨¡æ‹Ÿ
- **å¯è§†åŒ–æŠ¥å‘Š**: è‡ªåŠ¨ç”Ÿæˆæ€§èƒ½æŠ¥å‘Šå’Œå„ç±»åˆ†æå›¾è¡¨
- **å·¥ç¨‹åŒ–è®¾è®¡**: æ¨¡å—åŒ–ç»“æ„ï¼Œæ˜“äºæ‰©å±•å’Œå®šåˆ¶

## ğŸ“ é¡¹ç›®ç»“æ„

```
lightgbm_stock_predictor/
â”œâ”€â”€ backtester.py           # å›æµ‹æ¨¡å—
â”œâ”€â”€ config.py               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ data_loader.py          # æ•°æ®åŠ è½½æ¨¡å—
â”œâ”€â”€ evaluation.py          # æ¨¡å‹è¯„ä¼°æ¨¡å—
â”œâ”€â”€ feature_engineering.py  # ç‰¹å¾å·¥ç¨‹æ¨¡å—
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åº
â”œâ”€â”€ model.py                # æ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹æ¨¡å—
â”œâ”€â”€ requirements.txt        # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ signal_generator.py     # ä¿¡å·ç”Ÿæˆæ¨¡å—
â”œâ”€â”€ utils.py               # å·¥å…·å‡½æ•°
â””â”€â”€ visualization.py        # å¯è§†åŒ–æ¨¡å—
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd lightgbm_stock_predictor

# å®‰è£…ä¾èµ–åŒ…
pip install -r requirements.txt
```

### 2. è¿è¡Œé¡¹ç›®

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®è¿è¡Œï¼ˆé¢„æµ‹ä¸Šè¯æŒ‡æ•°ï¼‰
python main.py

# æŒ‡å®šè‚¡ç¥¨ä»£ç è¿è¡Œ
python main.py --stock 000001

# ä¸ä½¿ç”¨walk-forwardè®­ç»ƒ
python main.py --no-walk-forward

# ä¸ä¿å­˜è¾“å‡ºæ–‡ä»¶
python main.py --no-save
```

## âš™ï¸ é…ç½®è¯´æ˜

é¡¹ç›®é…ç½®åœ¨ `config.py` æ–‡ä»¶ä¸­ï¼š

### æ•°æ®é…ç½®
```python
DATA_CONFIG = {
    'start_date': '20200101',      # æ•°æ®å¼€å§‹æ—¥æœŸ
    'end_date': '20241231',        # æ•°æ®ç»“æŸæ—¥æœŸ
    'target_stock': 'sh',          # ç›®æ ‡è‚¡ç¥¨ä»£ç  ('sh'=ä¸Šè¯æŒ‡æ•°)
    'predict_days': 20,            # é¢„æµ‹å¤©æ•°ï¼ˆçº¦1ä¸ªæœˆï¼‰
    'feature_windows': [5, 10, 20, 30, 60]  # ç‰¹å¾è®¡ç®—çª—å£
}
```

### æ¨¡å‹é…ç½®
```python
MODEL_CONFIG = {
    'objective': 'regression',     # å›å½’ä»»åŠ¡
    'metric': 'rmse',             # è¯„ä¼°æŒ‡æ ‡
    'boosting_type': 'gbdt',      # æå‡æ–¹æ³•
    'num_leaves': 31,             # å¶å­èŠ‚ç‚¹æ•°
    'learning_rate': 0.05,        # å­¦ä¹ ç‡
    'feature_fraction': 0.9,      # ç‰¹å¾é‡‡æ ·æ¯”ä¾‹
    'bagging_fraction': 0.8,      # æ ·æœ¬é‡‡æ ·æ¯”ä¾‹
    # ... æ›´å¤šå‚æ•°
}
```

### å›æµ‹é…ç½®
```python
BACKTEST_CONFIG = {
    'initial_cash': 100000,       # åˆå§‹èµ„é‡‘
    'transaction_fee': 0.001,     # äº¤æ˜“è´¹ç‡ (0.1%)
    'slippage': 0.001             # æ»‘ç‚¹ (0.1%)
}
```

## ğŸ“Š è¾“å‡ºç»“æœ

è¿è¡Œåä¼šåœ¨ `output/` ç›®å½•ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

- `strategy_data.csv`: äº¤æ˜“ç­–ç•¥æ•°æ®
- `predictions.csv`: é¢„æµ‹ç»“æœ
- `portfolio_history.csv`: æŠ•èµ„ç»„åˆå†å²
- `trade_log.csv`: äº¤æ˜“æ—¥å¿—
- `performance_report.png`: ç»¼åˆæ€§èƒ½æŠ¥å‘Šå›¾

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. æ•°æ®åŠ è½½ (`data_loader.py`)

- ä»akshareè·å–è‚¡ç¥¨æ—¥çº¿æ•°æ®
- è‡ªåŠ¨å¤„ç†æ•°æ®æ ¼å¼å’Œç¼ºå¤±å€¼
- æ”¯æŒä¸ªè‚¡å’ŒæŒ‡æ•°æ•°æ®è·å–
- åŒ…å«é”™è¯¯å¤„ç†å’Œæ•°æ®éªŒè¯

### 2. ç‰¹å¾å·¥ç¨‹ (`feature_engineering.py`)

è®¡ç®—ä»¥ä¸‹ç‰¹å¾ï¼š
- ç§»åŠ¨å¹³å‡çº¿ (MA, EMA)
- æŠ€æœ¯æŒ‡æ ‡ (RSI, MACD, å¸ƒæ—å¸¦)
- ä»·æ ¼ç‰¹å¾ (ä»·æ ¼å˜åŒ–ç‡ã€æ³¢åŠ¨ç‡)
- æˆäº¤é‡ç‰¹å¾ (æˆäº¤é‡æ¯”ç‡ã€MA)
- æ»åç‰¹å¾ (å†å²ä»·æ ¼ã€æˆäº¤é‡)
- ç›®æ ‡å˜é‡ (æœªæ¥Nå¤©æ”¶ç›Šç‡)

### 3. æ¨¡å‹è®­ç»ƒ (`model.py`)

- LightGBMå›å½’æ¨¡å‹
- æ”¯æŒæ ‡å‡†è®­ç»ƒå’ŒWalk-forwardè®­ç»ƒ
- äº¤å‰éªŒè¯å’Œæ—©åœæœºåˆ¶
- ç‰¹å¾é‡è¦æ€§åˆ†æ

### 4. ä¿¡å·ç”Ÿæˆ (`signal_generator.py`)

- åŸºäºé¢„æµ‹æ”¶ç›Šç”Ÿæˆä¹°å–ä¿¡å·
- å¸¦ç½®ä¿¡åº¦çš„ä¿¡å·ç³»ç»Ÿ
- å¤´å¯¸å¤§å°ç®¡ç†
- é£é™©æ§åˆ¶è§„åˆ™

### 5. å›æµ‹ç³»ç»Ÿ (`backtester.py`)

- å®Œæ•´çš„äº¤æ˜“æ¨¡æ‹Ÿå™¨
- æ”¯æŒäº¤æ˜“è´¹ç”¨å’Œæ»‘ç‚¹
- è®¡ç®—å…³é”®ç»©æ•ˆæŒ‡æ ‡ï¼š
  - æ€»æ”¶ç›Šç‡å’Œå¹´åŒ–æ”¶ç›Šç‡
  - å¤æ™®æ¯”ç‡å’Œæœ€å¤§å›æ’¤
  - èƒœç‡å’Œäº¤æ˜“é¢‘ç‡

### 6. å¯è§†åŒ– (`visualization.py`)

- è‚¡ä»·èµ°åŠ¿å’Œäº¤æ˜“ä¿¡å·å›¾
- é¢„æµ‹vså®é™…å¯¹æ¯”å›¾
- å›æµ‹ç»“æœå’Œå›æ’¤åˆ†æ
- ç‰¹å¾é‡è¦æ€§å›¾
- ç»¼åˆæ€§èƒ½æŠ¥å‘Š

## ğŸ“ˆ æ¨¡å‹åŸç†

### é¢„æµ‹ç›®æ ‡
é¢„æµ‹è‚¡ç¥¨åœ¨æœªæ¥20ä¸ªäº¤æ˜“æ—¥ï¼ˆçº¦1ä¸ªæœˆï¼‰çš„æ”¶ç›Šç‡ï¼š

```
target = close(t+20) / close(t) - 1
```

### ç‰¹å¾å·¥ç¨‹
é€šè¿‡æŠ€æœ¯åˆ†æå’Œç»Ÿè®¡æ–¹æ³•æ„é€ å¤šå…ƒåŒ–ç‰¹å¾ï¼ŒåŒ…æ‹¬ï¼š
1. è¶‹åŠ¿ç±»ï¼šç§»åŠ¨å¹³å‡çº¿ã€ä»·æ ¼æ¯”ç‡
2. åŠ¨é‡ç±»ï¼šRSIã€MACDã€ä»·æ ¼å˜åŒ–ç‡
3. æ³¢åŠ¨ç±»ï¼šå¸ƒæ—å¸¦ã€å†å²æ³¢åŠ¨ç‡
4. æˆäº¤é‡ç±»ï¼šæˆäº¤é‡æ¯”ç‡ã€é‡ä»·å…³ç³»

### æ¨¡å‹è®­ç»ƒ
ä½¿ç”¨LightGBMæ¢¯åº¦æå‡æ ‘è¿›è¡Œè®­ç»ƒï¼š
- æŸå¤±å‡½æ•°ï¼šå‡æ–¹è¯¯å·®ï¼ˆMSEï¼‰
- ä¼˜åŒ–ç®—æ³•ï¼šæ¢¯åº¦æå‡
- æ­£åˆ™åŒ–ï¼šå¶å­èŠ‚ç‚¹æ•°é™åˆ¶ã€ç‰¹å¾é‡‡æ ·

### Walk-forwardè®­ç»ƒ
æ¨¡æ‹Ÿå®é™…äº¤æ˜“ç¯å¢ƒçš„è®­ç»ƒæ–¹æ³•ï¼š
1. æŒ‰æ—¶é—´é¡ºåºåˆ’åˆ†è®­ç»ƒ/æµ‹è¯•é›†
2. é€æ­¥æ‰©å±•è®­ç»ƒæ•°æ®
3. å¤šä¸ªå‘¨æœŸéªŒè¯æ¨¡å‹ç¨³å®šæ€§

## ğŸ› ï¸ è‡ªå®šä¹‰æ‰©å±•

### æ·»åŠ æ–°ç‰¹å¾
åœ¨ `feature_engineering.py` çš„ `calculate_technical_indicators` å‡½æ•°ä¸­æ·»åŠ ï¼š

```python
def calculate_technical_indicators(df: pd.DataFrame) -> pd.DataFrame:
    df = df.copy()
    # ... ç°æœ‰ç‰¹å¾
    
    # æ·»åŠ æ–°çš„æŠ€æœ¯æŒ‡æ ‡
    df['NEW_FEATURE'] = your_calculation_function(df)
    
    return df
```

### ä¿®æ”¹äº¤æ˜“ç­–ç•¥
åœ¨ `signal_generator.py` ä¸­è°ƒæ•´ï¼š

```python
def generate_trading_signals(predictions: np.ndarray, threshold: float = 0.02) -> List[int]:
    # ä¿®æ”¹é˜ˆå€¼æˆ–ä¿¡å·é€»è¾‘
    signals = []
    for pred in predictions:
        if pred > threshold:      # ä¹°å…¥æ¡ä»¶
            signals.append(1)
        elif pred < -threshold:   # å–å‡ºæ¡ä»¶
            signals.append(-1)
        else:                     # æŒæœ‰æ¡ä»¶
            signals.append(0)
    return signals
```

### è°ƒæ•´å›æµ‹å‚æ•°
åœ¨ `config.py` ä¸­ä¿®æ”¹å›æµ‹é…ç½®ï¼š

```python
BACKTEST_CONFIG = {
    'initial_cash': 1000000,     # å¢åŠ åˆå§‹èµ„é‡‘
    'transaction_fee': 0.0005,   # é™ä½äº¤æ˜“è´¹ç”¨
    'slippage': 0.0005          # é™ä½æ»‘ç‚¹
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®è´¨é‡**ï¼šakshareæ•°æ®å¯èƒ½å­˜åœ¨ç¼ºå¤±æˆ–å¼‚å¸¸å€¼
2. **è¿‡æ‹Ÿåˆé£é™©**ï¼šå†å²è¡¨ç°ä¸ä»£è¡¨æœªæ¥æ”¶ç›Š
3. **äº¤æ˜“æˆæœ¬**ï¼šå®é™…äº¤æ˜“ä¸­æˆæœ¬å¯èƒ½æ›´é«˜
4. **æ¨¡å‹ç¨³å®šæ€§**ï¼šä¸åŒå¸‚åœºç¯å¢ƒä¸‹æ¨¡å‹è¡¨ç°å¯èƒ½ä¸åŒ
5. **å­¦ä¹ ç”¨é€”**ï¼šæœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨

## ğŸ“š å‚è€ƒèµ„æ–™

- [LightGBMå®˜æ–¹æ–‡æ¡£](https://lightgbm.readthedocs.io/)
- [akshareæ–‡æ¡£](https://akshare.readthedocs.io/)
- ã€ŠPythoné‡‘èå¤§æ•°æ®åˆ†æã€‹
- ã€Šé‡åŒ–äº¤æ˜“ï¼šå¦‚ä½•å»ºç«‹è‡ªå·±çš„ç®—æ³•äº¤æ˜“äº‹ä¸šã€‹

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æå‡ºIssueæˆ–PRã€‚

---
**å…è´£å£°æ˜**ï¼šæœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ äº¤æµï¼Œä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œå…¥å¸‚éœ€è°¨æ…ã€‚